#########################################################################
# Title:            Community: DelugeVPN                                #
# Author(s):        maximuskowalski, Migz93                             #
# URL:              https://github.com/Cloudbox/Community               #
# Docker Image(s):  binhex/arch-delugevpn                               #
# --                                                                    #
#         Part of the Cloudbox project: https://cloudbox.works          #
#########################################################################
#                   GNU General Public License v3.0                     #
#########################################################################
---

## Checks

- name: Settings | Wait for 'core.conf' to be created
  wait_for:
    path: "/opt/delugevpn/core.conf"
    state: present

- name: Settings | Wait for 10 seconds before stopping delugevpn container
  wait_for:
    timeout: 10

- name: Settings | Stop container
  docker_container:
    name: delugevpn
    state: stopped

## Adjusting directories

- name: Settings | Set download directory
  lineinfile:
    path: "/opt/delugevpn/core.conf"
    regexp: '^\s\s\s\s"download_location":\s*'
    line: '    "download_location": "/downloads/torrents/deluge",'
    state: present

- name: Settings | Set completed directory
  lineinfile:
    path: "/opt/delugevpn/core.conf"
    regexp: '^\s\s\s\s"move_completed_path":\s*'
    line: '    "move_completed_path": "/downloads/torrents/deluge/completed",'
    state: present

- name: Settings | Set torrents directory
  lineinfile:
    path: "/opt/delugevpn/core.conf"
    regexp: '^\s\s\s\s"torrentfiles_location":\s*'
    line: '    "torrentfiles_location": "/downloads/torrents/deluge/torrents",'
    state: present

## Restart Container

- name: Settings | Start container
  docker_container:
    name: delugevpn
    state: started